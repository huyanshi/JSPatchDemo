# JSPatchDemo
iOS开发swift热修复实践
# 一、热修复的背景和选取方案
##1.1背景
  工作中容易犯错、bug难以避免；开发和测试人力有限；苹果Appstore审核周期太长，一旦出现严重bug难以快速上线新版本；作为生产力工具，用户有对稳定性和可靠性的需求。
##1.2选取方案分析

* (1) 申请“加急审核” <br>
方法：提交应用时，选择”加急审核”。<br>
优点：操作简单，只需要重新上传应用即可;<br>
缺点：“加急审核”，肯定是不能经常使用的。<br>
简评：我想，这可能是大多数公司遇到紧急问题时，最常使用的方案。一个应用每年是有若干次机会申请“加急审核”，来缩短应用新版本的审核周期。通常审核周期是7天左右；”加急审核”，通常只需要3天左右。
* (2) 使用 WebVView + Html5 页面<br>
方法：特定的可能需要经常换的页面使用WebView来显示，内部使用Html5的内容来填充.当需要改变页面时，只需要改变下服务器接口返回的内容即可。<br>
优点：对于内容的更新，足够灵活和迅速。<br>
缺点：无法修复非HTML5页面的Bug，Html5 交互和UI通常逊色于原生页面。<br>
简评：混合应用常用的方式，如PhoneGap等；对于大多数原生应用来说，此方案基本无适用性。
* (3) 编写基于ReactNative的应用<br>
方法：使用 ReactNative 来编写应用或应用的部分页面，更多介绍参见：React Native 官方文档中文版。<br>
优点：原生UI，原生交互，支持服务器方式在线更新应用。<br>
缺点：对于非ReactNative编写的页面无能为力。<br>
简评：个人主观是很看好 ReactNative的，也在慢慢踩坑；但现实是大部分公司的已有项目是基于Objetive-C的，所以基于ReactNative的在线更新策略，目前对于大多说公司来说也并不具有可行性。
* (4) 基于WaxPatch实现在线补丁式更新<br>
方法：在自己的项目中引入WaxPatch库，然后参见下文继续讨论的方案细节实施即可。<br>
优点：支持iOS6 ，支持操作所有工程中引入的CocoaTouch库与各种第三方库。<br>
缺点：Wax框架已经停止维护四五年，有可能审核不通过，Lua扩展脚本语言应用不广泛，不支持Objective-C里block跟Lua程序的互传。<br>
简评： Wax使用lua语言，3年没有更新，而且苹果对于Wax使用的态度也处于模糊状态，这也是一个潜在的使用风险。
* (5) 基于JSPatch实现在线补丁式更新<br>
方法：在自己的项目中引入JSPatch库，然后参见下文继续讨论的方案细节实施即可参照JSPatch的入门使用。<br>
优点：支持操作所有工程中引入的CocoaTouch库与各种第三方库。可完全自由定义与重写已有代码的逻辑，符合Apple规则，小巧，支持block。<br>
缺点：JS语法操作API，语法转换有一定成本，最低版本兼容iOS7。<br>
简评：大多数时候我们需要的只是重写下某个方法，甚至某个判断某个默认值，就可以很好地修复某个线上的Bug。所以JSPatch已经够用了。当然，如果是对于复杂的新功能的添加的话，建议还是提交审核吧。另外不得不说JSPatch + ReactNatvie 将来或许会成为一个很强力的组合，前者侧重于Bug的修复，后者侧重于复杂新需求的添加。

# 二、JSPatch介绍和应用项目
JSPatch诞生于2015年5月，最初是腾讯广研高级iOS开发@bang的个人项目。它能够使用JavaScript调用Objective-C的原生接口，从而动态植入代码来替换旧代码，以实现修复线上bug。JSPatch在Github.com上开源后获得了3000多个star和500多fork，广受关注，目前已被应用在大量腾讯/阿里/百度的App中。
## 2.1 JSPatch作者简介
JSPatch的作者是bang，1988年生于广东陆丰，毕业于华南师范大学，职业程序员，个人的签名是做自己喜欢做的事。经常上新浪微博，有时用Instagram拍照，会去豆瓣找书和电影，偶尔上twitter。可以看出作者是一个比较自由思维开阔的程序猿。下图2-1是bang的github地址。
